version: '3.6'

services:
  # prometheus:
  #   image: prom/prometheus:latest
  #   container_name: prometheus
  #   entrypoint:
  #     - /bin/prometheus
  #     - --config.file=/etc/prometheus/prometheus.yml
  #     - --web.external-url=https://nginx/prometheus
  #     - --web.route-prefix=/
  #   volumes:
  #     - ${PWD}/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
  #   ports:
  #     - 9091:9090

  # federated-prom:
  #   image: prom/prometheus:latest
  #   container_name: federated-prometheus
  #   volumes:
  #     - ${PWD}/federated/prometheus.yml:/etc/prometheus/prometheus.yml
  #     - ${PWD}/prometheus/nginx.crt:/etc/prometheus/nginx.crt
  #     - ${PWD}/federated/federated-prom.crt:/etc/prometheus/federated-prom.crt
  #     - ${PWD}/federated/federated-prom.key:/etc/prometheus/federated-prom.key
  #   ports:
  #     - 9090:9090

  # # grafana:
  # #   image: grafana/grafana:latest
  # #   container_name: grafana
  # #   ports:
  # #     - 3060:3000

  app:
    build:
      context: ./app
    network_mode: host
    ports:
      - 3100:3100

  nginx:
    image: nginx:1.15
    network_mode: host
    container_name: nginx
    volumes:
      - ./prometheus/nginx:/etc/nginx:ro
      - ./prometheus/certs:/etc/certs:ro
    ports:
      - 8443:8443
      - 8080:80
